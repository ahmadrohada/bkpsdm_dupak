<?php if(!isset($_SERVER['HTTP_REFERER'])) { ?><script type="text/javascript">document.location  = "./index.php";</script><?php exit(); }  ?><!--=====================================================- > **********************************************************                   TAMPIL DATA GURU**********************************************************<--====================================================---->	<h3 class="page-header">DATA GURU</h3><table  width="100%"><tr><!--	<td align="left">		<a href="?page=data_pegawai&aksi=tambah"><button class="ui-state-default tambah"  >Tambah Data Pegawai</button></a>	</td>-->	<td align="right">		<form action="" method="post">		Cari dengan Nama atau Nip Baru &nbsp;&nbsp;&nbsp;<input  type="text" name="txtcari"  size="20" maxlength="30" > <input type="submit" name="cari" value="Cari">		</form>	</td></tr></table><br><table border="1" class="data table-hover" width="100%"><thead>        <tr>			<th width="6%">No</th>            <th width="13%">NIP BARU</th>            <th width="10%">NIP LAMA</th>			<th width="25%">NAMA LENGKAP</th>			<th width="6%">JK</th>			<th width="19%">TEMPAT/TANGGAL LAHIR</th>			<th >AKSI</th>        </tr>    </thead><tbody>	<?phpif((!isset($_GET['hal'])) | (isset($_POST['cari'])))	{		$nohal = 1;	} 	else 		$nohal = $_GET['hal'];$nama_file = "data_guru";		$dataperhal = 20;$offset = ($nohal - 1) * $dataperhal; //no record awal yang akan ditampilkan$page= array(); //menampilkan data dengan pagination$all= array(); //menampilkan data tanpa pagination$page['limit'] = $offset.",".$dataperhal;//PENCARIAN DATA$_POST['cari'] = isset($_POST['cari']) ? $_POST['cari'] : '';$_GET['cari'] = isset($_GET['cari']) ? $_GET['cari'] : '';$page['field'] = "dt_pegawai.*,kd_skpd.*";$all['field']  = "dt_pegawai.*,kd_skpd.*";if( (isset($_POST['cari'])) | (isset($_GET['cari']))){		if($_POST['cari']!=null){			$txtcari=$_POST['txtcari'];		}else			$txtcari=$_GET['cari'];		//pencarian data			$page['jika'] = "dt_pegawai.kd_skpd = kd_skpd.kd_skpd and ( kd_skpd.sekolah LIKE '%SDN%' or kd_skpd.sekolah LIKE '%SMPN%' or kd_skpd.sekolah LIKE '%SMAN%' or kd_skpd.sekolah LIKE '%SMKN%' ) and (dt_pegawai.nama LIKE '%$txtcari%' or dt_pegawai.nip_baru = '$txtcari' or kd_skpd.sekolah LIKE '%$txtcari%')";			$all['jika'] = "dt_pegawai.kd_skpd = kd_skpd.kd_skpd and ( kd_skpd.sekolah LIKE '%SDN%' or kd_skpd.sekolah LIKE '%SMPN%' or kd_skpd.sekolah LIKE '%SMAN%' or kd_skpd.sekolah LIKE '%SMKN%' ) and (dt_pegawai.nama LIKE '%$txtcari%' or dt_pegawai.nip_baru = '$txtcari' or kd_skpd.sekolah LIKE '%$txtcari%')";				$_SESSION['cari']="&cari=".$txtcari; //menyiapkan GET cari untuk pagination		$_SESSION['nama_file']= $nama_file;} else {					$page['jika'] = "dt_pegawai.kd_skpd = kd_skpd.kd_skpd and ( kd_skpd.sekolah LIKE '%SDN%' or kd_skpd.sekolah LIKE '%SMPN%' or kd_skpd.sekolah LIKE '%SMAN%' or kd_skpd.sekolah LIKE '%SMKN%' )";			$all['jika'] = "dt_pegawai.kd_skpd = kd_skpd.kd_skpd and( kd_skpd.sekolah LIKE '%SDN%' or kd_skpd.sekolah LIKE '%SMPN%' or kd_skpd.sekolah LIKE '%SMAN%' or kd_skpd.sekolah LIKE '%SMKN%' )";}	include_once dirname(__FILE__).DIRECTORY_SEPARATOR.'../kelas/pustaka.php';	$dataPeg	 	= 	New KelolaPegawai();	$hasil 			= 	$dataPeg->TampilDataPegawai("dt_pegawai,kd_skpd",$page);	//mencari jumlah seluruh data	$hasil2= $dataPeg->TampilDataPegawai("dt_pegawai,kd_skpd",$all);	$jumdata=0;	foreach($hasil2 as $j){ $jumdata=$jumdata+1; }	//mencari jumlah data yang harus ditampilkan perhalaman	$jumhal = ceil($jumdata/$dataperhal);	//penomoran data	$no=1 + ($nohal*$dataperhal) -$dataperhal;	foreach($hasil as $r)	{		//pencarian gelar pada data PAK	$x = mysql_query("SELECT no_pak FROM dt_pak WHERE nip_baru='$r->nip_baru' ORDER BY tgl_pak ASC");	$data = mysql_num_rows($x);	//jika ditemukan data lebih dari 1	if ( $data > 1 ) {		while ($c = mysql_fetch_array($x)){					$dpt = $c['no_pak'];			}					$pak_terakhir = mysql_fetch_object(mysql_query("SELECT * FROM dt_pak WHERE no_pak='$dpt' "));			} else {					$pak_terakhir = mysql_fetch_object(mysql_query("SELECT * FROM dt_pak WHERE nip_baru='$r->nip_baru' ORDER BY tgl_pak DESC"));			}		$pak_terakhir = isset($pak_terakhir->no_pak) ? $pak_terakhir->no_pak : '';	$glr		=   mysql_fetch_object(mysql_query("SELECT gelar_dpn,gelar_blk FROM tb_pak_guru_pend WHERE no_pak='$pak_terakhir' "));	$glr		=   mysql_fetch_object(mysql_query("SELECT gelar_dpn,gelar_blk FROM tb_pak_guru_pend WHERE no_pak='$pak_terakhir' "));	$d 			= 	New FormatTanggal();		?><tr>	<td align="center" width="5%">		<?php echo $no; ?>	</td>	<td width="">		<?php echo $r->nip_baru; ?>	</td>    <td align="center">		<?php echo $r->nip_lama; ?>	</td>    <td width="">		<?php 		$g_blk = isset($glr->gelar_blk) ? $glr->gelar_blk : '';		if ($g_blk == null ) 		{ $koma = ""; } else { $koma = ", ";};		$g_dpn = isset($glr->gelar_dpn) ? $glr->gelar_dpn : '';		if ($g_dpn == null ) 		{ $titik = ""; } else { $titik = ". ";};		echo  $g_dpn.$titik.ucwords(strtolower($r->nama)).$koma.$g_blk;	?>	</td>	 <td align="center">		<?php		if ( $r->jk==1) echo "L";		if ( $r->jk==2) echo "P";		?>	</td>	<td width="">		<?php 		//tempat tanggal lahir		$tl		= $d->balik($r->tgl_lahir);		echo ucwords(strtolower($r->tmp_lahir)).", ".$tl;		?>	</td>	<td align="center">		<a href="?page=detail_pegawai&id=<?php echo $r->id_pegawai; ?>" class="aksi">LIHAT DATA</a>		<a href="?page=history_pak&id=<?php echo $r->id_pegawai; ?>" class="aksi">HISTORY PAK</a>	</td></tr><?php$no = $no+1;}?></tbody></table><br><?phpinclude ("kelas/pagination.php");?>